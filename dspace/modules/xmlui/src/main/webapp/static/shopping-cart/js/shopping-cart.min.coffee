(function(){var t;t={addToCartButtons:$(".access.order"),itembox:$(".item-wrapper, #aspect_artifactbrowser_ItemViewer_div_item-view"),cssPath:"/static/shopping-cart/css/",i18nPath:"/static/shopping-cart/i18n/",pluginPath:"/static/shopping-cart/plugins/",templatePath:"/static/shopping-cart/templates/",currencySymbol:"&euro;",language:"en"===$("#ds-language-selection").text().substring(1,3).toLowercase()?"en":"de",orderUrl:"/order",shippingUrl:"/costrequest"}}).call(this),function(){var t;t={},t.options=options,t.messages=messages,$(function(){var e;return e=t,document.createStyleSheet?document.createStyleSheet(e.options.cssPath+"shopping-cart.css"):$("head").append("<link rel='stylesheet' type='text/css' href='"+e.options.cssPath+"shopping-cart.css'>"),$.when($.get(e.options.templatePath+"infobox.html"),$.get(e.options.templatePath+"form.html"),$.getJSON(e.options.i18nPath+"countries."+e.options.language+".json")).done(function(t,i,r){var o;return $("body").append(t[0],i[0]),e.scope=$(".shopping-cart"),"de"!==e.options.language&&e.scope.find("[data-"+e.options.language+"]").each(function(){var t,i,r,o,n;for(o=this.childNodes,n=[],t=0,i=o.length;i>t;t++){if(r=o[t],"#text"===r.nodeName&&null!==r.nodeValue){r.nodeValue=$(this).data(e.options.language);break}n.push(void 0)}return n}),$('select[data-model="countrycode"]',e.scope).each(function(){var t,e,i,o,n;$(this).append($("<option/>")),i=r[0],o=[];for(t in i)n=i[t],e=$("<option/>").attr("value",t).text(n),o.push($(this).append(e));return o}),$.getScript(e.options.pluginPath+"chosen/chosen.jquery.min.js",function(){return $('select[data-model="countrycode"]').chosen({placeholder_text_single:" "})}),e.view=new View,e.storage=new Storage,o=e.storage.read(),o?(e.order=o,e.order.updateShipping()):(e.order=new Order,$(":input[data-default]",e.scope).each(function(){return $(this).val($(this).data("default")),$(this).change()})),e.view.update()})})}.call(this),function(){Number.prototype.toCurrency=function(){var t,e;return t=ShoppingCart,e=t.options.currencySymbol+"&nbsp;"+this.toFixed(2),null!=t.options.language&&"de"===t.options.language&&(e=e.replace(".",",")),e},$.fn.extend({animateflyTo:function(t){return this.each(function(){var e,i;return i=$(this),e=i.clone(),e.css({background:"#eee",overflow:"hidden",position:"fixed",right:$(window).width()-i.offset().left-i.outerWidth(),top:i.offset().top-$(window).scrollTop(),width:i.width()}),e.insertAfter(i).animate({right:$(window).width()-t.offset().left-t.outerWidth(),top:t.offset().top-$(window).scrollTop(),width:t.outerWidth(),height:t.outerHeight(),opacity:.5},"slow",function(){return e.fadeOut(200,function(){return e.remove()}),t.flash()})})},flash:function(t){return null==t&&(t=!1),this.each(function(){return t?$(this).stop(!0,!0).fadeIn():$(this).stop(!0,!0).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)})},highlightIfEmpty:function(){var t;return t=!0,this.each(function(){var e;return e=$(this).closest("fieldset"),0===$(this).val().length||$(this).is(":checkbox")&&!$(this).prop("checked")?($(this).addClass("error"),e.addClass("error"),t=!1,void 0):($(this).removeClass("error"),e.removeClass("error"))}),t}})}.call(this),function(){var t;t=function(){function t(t){this.uuid=t,this.amount=0,this.contributor=0,this.description="",this.id=0,this.part="",this.quantity=1,this.shipping=0,this.sum=0,this.title="&mdash;"}var e;return e=ShoppingCart,t.prototype.setAmount=function(t){return this.amount=t,this.sum=this.quantity*t},t}()}.call(this),function(){var t;t=function(){function t(){this.count=0,this.customer={},this.customer.equalsDelivery=!0,this.delivery={},this.items=[],this.shipping=0,this.sent=!1,this.subtotal=0,this.total=0}var e;return e=ShoppingCart,t.prototype.addItem=function(t,i){var r;return null==i&&(i=!0),r=this.items.map(function(t){return t.uuid}).indexOf(t.uuid),0>r?(this.items.push(t),this.count+=t.quantity,this.subtotal+=t.sum):this.items[r].quantity<99&&(this.items[r].quantity++,this.count++,this.items[r].sum+=this.items[r].amount,this.subtotal+=this.items[r].amount),i?(this.updateShipping(),e.view.update(),e.storage.update(this)):void 0},t.prototype.removeItem=function(t,i){var r;return null==i&&(i=!1),r=this.items.map(function(t){return t.uuid}).indexOf(t),i?(this.count-=this.items[r].quantity,this.subtotal-=this.items[r].sum,this.items.splice(r,1)):this.items[r].quantity>1&&(this.items[r].quantity--,this.items[r].sum-=this.items[r].amount,this.count--,this.subtotal-=this.items[r].amount),this.updateShipping(),e.view.update(),e.storage.update(this)},t.prototype.removeAllItems=function(){return this.items=[],this.count=0,this.shipping=0,this.subtotal=0,this.total=0,e.view.update(),e.storage.update(this)},t.prototype.submit=function(){var t,i;return(i=$(":input[required]:visible",e.scope).highlightIfEmpty())?(t=JSON.parse(JSON.stringify(this)),t.customer.name=t.customer.firstname+" "+t.customer.lastname,t.customer.country=$("select[data-model='countrycode']:eq(0) option[value='"+t.customer.countrycode+"']").text(),this.customer.equalsDelivery?delete t.delivery:(t.delivery.name=t.delivery.firstname+" "+t.delivery.lastname,t.delivery.country=$("select[data-model='countrycode']:eq(0) option[value='"+t.delivery.countrycode+"']").text()),$.each(t.items,function(e,i){return t.items[e].id=i.id.toString(),t.items[e].quantity=i.quantity.toString()}),$.ajax({type:"POST",url:e.options.orderUrl,contentType:"application/x-www-form-urlencoded",data:{order:JSON.stringify(t)}}).done(function(t){return function(i){var r,o;return r=i.indexOf("{"),r&&(i=i.substring(r)),o=JSON.parse(i),"true"===o.success?(e.view.message("orderReceived","success"),t.sent=!0,t.removeAllItems()):e.view.message("orderInvalid","error","<br>"+o.error)}}(this)).fail(function(t){return function(t){return e.view.message("unexpectedSubmitError","error")}}(this))):void e.view.message("fillAllFields","warning")},t.prototype.updateShipping=function(){var t,i,r;return 0===this.count?void(this.shipping=0):(i={},i.countrycode=e.order.customer.equalsDelivery?e.order.customer.countrycode:e.order.delivery.countrycode,i.items=[],$.each(e.order.items,function(t,e){var r;return r={},r.id=e.id.toString(),r.quantity=e.quantity.toString(),r.part=e.part,i.items.push(r)}),r=0,t=this.shipping,$.ajax({type:"POST",url:e.options.orderUrl,contentType:"application/x-www-form-urlencoded",data:{costrequest:JSON.stringify(i)}}).done(function(i){return function(o){var n;return n=o.indexOf("{"),n&&(o=o.substring(n)),r=JSON.parse(o),null!=r.shipping&&parseFloat(r.shipping)>=0&&"-"!==r.shipping.substring(0,1)?(i.shipping=parseFloat(r.shipping.replace(",",".")),i.total=parseFloat(r.total.replace(",",".")),i.shipping!==t&&e.view.message("shippingUpdated","temp")):(e.view.message("shippingCalculationError","error"),i.shipping=!1,i.total=!1),e.view.update()}}(this)).fail(function(i){return e.view.message("shippingCalculationError","error"),this.shipping=!1,this.total=!1,this.shipping!==t?e.view.update():void 0}))},t}()}.call(this),function(){var t;t=function(){function t(){}return t.prototype.read=function(){var t,e,i,r,o,n;if(null!=localStorage.order){if(n=JSON.parse(localStorage.order),r=new Order,r.customer=n.customer,r.delivery=n.delivery,null!=n.items)for(o=n.items,t=0,i=o.length;i>t;t++)e=o[t],r.addItem(e,!1);return r}return!1},t.prototype.update=function(t){return localStorage.order=JSON.stringify(t)},t}()}.call(this),function(){var t;t=function(){function t(){var t,i;i=$(".shopping-cart.infobox:first"),t=$(".shopping-cart.form:first"),i.click(function(){return t.fadeIn(),$("html, body").animate({scrollTop:0})}),$(".close.form",e.scope).click(function(e){return t.fadeOut()}),$("body").click(function(){return $(".close.form",e.scope).click()}),$(".shopping-cart").click(function(t){return t.stopPropagation()}),$("div.conditions",e.scope).hide().append($("<div/>").load(e.options.i18nPath+"conditions."+e.options.language+".html")),$(".show.conditions").click(function(){return $("div.conditions:hidden").slideDown(),!1}),$(".close.conditions").click(function(){return $("div.conditions").slideUp(),!1}),e.options.addToCartButtons.click(function(){var t,r,o,n;return r=$(this),n=r.data("id")+r.data("part"),o=new Item(n),o.id=r.data("id"),o.part=r.data("part"),o.contributor=r.data("contributor"),o.description=r.data("description"),o.title=r.data("title"),o.setAmount(+r.data("amount").toString().replace(",",".")),e.order.addItem(o),t=$(this).closest(e.options.itembox),t.animateflyTo(i),!1}),$("button",e.scope).click(function(t){return t.preventDefault()}),$(".remove",e.scope).click(function(){var t;return t=$(this).closest(".item").attr("data-item-uuid"),e.order.removeItem(t,!0),!1}),$(".less, .more",e.scope).click(function(){var t,i;return i=$(this).closest(".item").attr("data-item-uuid"),$(this).hasClass("less")?e.order.removeItem(i):(t=new Item(i),e.order.addItem(t)),!1}),$(":input[data-model]",e.scope).change(function(){var t,i,r,o,n;switch($(this).val($(this).val().trim()),n=$(this).attr("data-model"),o=$(this).closest("fieldset").attr("data-entity"),e.order[o][n]=$(this).is(":checkbox")?$(this).prop("checked"):$(this).val(),e.storage.update(e.order),$(this).is("[required]")&&$(this).highlightIfEmpty(),n){case"equalsDelivery":if(i=$(this).prop("checked"),t=$('[data-entity="delivery"]',e.scope),i?(t.slideUp(),t.find(".error").removeClass("error"),t.find(":input[data-model][required]").prop("required",!1).attr("data-required","")):(t.slideDown(),t.find(":input[data-model][data-required]").prop("required",!0).removeData("required")),e.order.customer.countrycode!==e.order.delivery.countrycode)return e.order.updateShipping();break;case"countrycode":if("customer"!==o)return e.order.updateShipping();if(e.order.customer.equalsDelivery)return r=$("[data-entity=delivery] :input[data-model=countrycode]",e.scope),r.val($(this).val()),r.change().trigger("chosen:updated")}}),$(".submit",e.scope).click(function(){return e.order.submit()})}var e,i;return e=ShoppingCart,i=null,t.prototype.message=function(t,e,r){var o,n,s,a;return null==e&&(e="success"),null==r&&(r=""),n=$(".message#"+t),n.flash("success"===e),clearInterval(i),"temp"===e?(o=$('<div class="countdown"/>'),n.append(o),s=5e3,a=0,i=setInterval(function(){return a+=50,o.css("width",a/s*100+"%"),a===s-1e3&&n.stop(!0,!0).fadeOut(1e3),a>=s?clearInterval(i):void 0},50)):void 0},t.prototype.update=function(){var t,i,r,o,n,s,a,u,c,d;for($(".item:first",e.scope).hide(),$(".item:gt(0)",e.scope).remove(),$(".sc-in-cart").removeClass("sc-in-cart"),i=$('[data-model="equalsDelivery"]').prop("checked"),i!==e.order.customer.equalsDelivery&&$('[data-model="equalsDelivery"]').prop("checked",e.order.customer.equalsDelivery).change(),0===e.order.items.length&&$(".message",e.scope).stop(!0,!0).fadeOut(1e3),a=e.order.items,r=0,n=a.length;n>r;r++)o=a[r],t=$(".item:first",e.scope).clone(!0),t.attr("data-item-uuid",o.uuid),$('[data-model="contributor"]',t).html(o.contributor),$('[data-model="description"]',t).html(o.description),$('[data-model="title"]',t).html(o.title),$('[data-model="quantity"]',t).html(o.quantity),$('[data-model="amount"]',t).html(o.amount.toCurrency()),$('[data-model="sum"]',t).html(o.sum.toCurrency()),t.appendTo(".items tbody").show(),e.options.addToCartButtons.filter("[data-id='"+o.id+"'][data-part='"+o.part+"']").addClass("sc-in-cart");$('[data-model="count"]',e.scope).html(e.order.count),$('[data-model="subtotal"]',e.scope).html(e.order.subtotal.toCurrency()),$('[data-model="shipping"]',e.scope).html(e.order.shipping!==!1?e.order.shipping.toCurrency():"?"),$('[data-model="total"]',e.scope).html(e.order.total!==!1?e.order.total.toCurrency():"?"),u=e.order.customer;for(s in u)d=u[s],$("[data-entity='customer'] [data-model='"+s+"']",e.scope).val(d);c=e.order.delivery;for(s in c)d=c[s],$("[data-entity='delivery'] [data-model='"+s+"']",e.scope).val(d);return $(".disable-if-empty",e.scope).prop("disabled",e.order.count<1),$(".show-if-empty",e.scope).each(function(){return $(this).toggle(0===e.order.count)}),$(".show-if-filled",e.scope).each(function(){return $(this).toggle(e.order.count>0)}),$(".show-if-one",e.scope).each(function(){return $(this).toggle(1===e.order.count)}),$(".show-if-multiple",e.scope).each(function(){return $(this).toggle(e.order.count>1)}),$("select",e.scope).trigger("chosen:updated")},t}()}.call(this);
