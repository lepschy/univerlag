(function(){var t;t=function(){function t(){this.count=0,this.customer={},this.customer.equalsDelivery=!0,this.delivery={},this.items=[],this.shipping=0,this.sent=!1,this.subtotal=0,this.total=0}var i;return i=ShoppingCart,t.prototype.addItem=function(t,e){var s;return null==e&&(e=!0),s=this.items.map(function(t){return t.uuid}).indexOf(t.uuid),0>s?(this.items.push(t),this.count+=t.quantity,this.subtotal+=t.sum):this.items[s].quantity<99&&(this.items[s].quantity++,this.count++,this.items[s].sum+=this.items[s].amount,this.subtotal+=this.items[s].amount),e?(this.updateShipping(),i.view.update(),i.storage.update(this)):void 0},t.prototype.removeItem=function(t,e){var s;return null==e&&(e=!1),s=this.items.map(function(t){return t.uuid}).indexOf(t),e?(this.count-=this.items[s].quantity,this.subtotal-=this.items[s].sum,this.items.splice(s,1)):this.items[s].quantity>1&&(this.items[s].quantity--,this.items[s].sum-=this.items[s].amount,this.count--,this.subtotal-=this.items[s].amount),this.updateShipping(),i.view.update(),i.storage.update(this)},t.prototype.removeAllItems=function(){return this.items=[],this.count=0,this.shipping=0,this.subtotal=0,this.total=0,i.view.update(),i.storage.update(this)},t.prototype.submit=function(){var t,e;return(e=$(":input[required]:visible",i.scope).highlightIfEmpty())?(t=JSON.parse(JSON.stringify(this)),t.customer.name=t.customer.firstname+" "+t.customer.lastname,t.customer.country=$("select[data-model='countrycode']:eq(0) option[value='"+t.customer.countrycode+"']").text(),this.customer.equalsDelivery?delete t.delivery:(t.delivery.name=t.delivery.firstname+" "+t.delivery.lastname,t.delivery.country=$("select[data-model='countrycode']:eq(0) option[value='"+t.delivery.countrycode+"']").text()),$.each(t.items,function(i,e){return t.items[i].id=e.id.toString(),t.items[i].quantity=e.quantity.toString()}),$.ajax({type:"POST",url:i.options.orderUrl,contentType:"application/x-www-form-urlencoded",data:{order:JSON.stringify(t)}}).done(function(t){return function(e){var s,r;return s=e.indexOf("{"),s&&(e=e.substring(s)),r=JSON.parse(e),"true"===r.success?(i.view.message("orderReceived","success"),t.sent=!0,t.removeAllItems()):i.view.message("orderInvalid","error","<br>"+r.error)}}(this)).fail(function(t){return function(t){return i.view.message("unexpectedSubmitError","error")}}(this))):void i.view.message("fillAllFields","warning")},t.prototype.updateShipping=function(){var t,e,s;return 0===this.count?void(this.shipping=0):(e={},e.countrycode=i.order.customer.equalsDelivery?i.order.customer.countrycode:i.order.delivery.countrycode,e.items=[],$.each(i.order.items,function(t,i){var s;return s={},s.id=i.id.toString(),s.quantity=i.quantity.toString(),s.part=i.part,e.items.push(s)}),s=0,t=this.shipping,$.ajax({type:"POST",url:i.options.orderUrl,contentType:"application/x-www-form-urlencoded",data:{costrequest:JSON.stringify(e)}}).done(function(e){return function(r){var n;return n=r.indexOf("{"),n&&(r=r.substring(n)),s=JSON.parse(r),null!=s.shipping&&parseFloat(s.shipping)>=0&&"-"!==s.shipping.substring(0,1)?(e.shipping=parseFloat(s.shipping.replace(",",".")),e.total=parseFloat(s.total.replace(",",".")),e.shipping!==t&&i.view.message("shippingUpdated","temp")):(i.view.message("shippingCalculationError","error"),e.shipping=!1,e.total=!1),i.view.update()}}(this)).fail(function(e){return i.view.message("shippingCalculationError","error"),this.shipping=!1,this.total=!1,this.shipping!==t?i.view.update():void 0}))},t}()}).call(this);